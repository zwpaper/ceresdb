<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CeresDB User Guide</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">About CeresDB</li><li class="chapter-item expanded "><a href="about.html"><strong aria-hidden="true">1.</strong> About CeresDB</a></li><li class="chapter-item expanded "><a href="quick_start.html"><strong aria-hidden="true">2.</strong> Quick Start</a></li><li class="chapter-item expanded affix "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="model/index.html"><strong aria-hidden="true">3.</strong> Data Model</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="model/data_types.html"><strong aria-hidden="true">3.1.</strong> Data Types</a></li><li class="chapter-item expanded "><a href="model/special_columns.html"><strong aria-hidden="true">3.2.</strong> Special Columns</a></li></ol></li><li class="chapter-item expanded "><a href="sql/index.html"><strong aria-hidden="true">4.</strong> SQL Syntax</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="sql/identifier.html"><strong aria-hidden="true">4.1.</strong> Identifier</a></li><li class="chapter-item expanded "><a href="sql/ddl/index.html"><strong aria-hidden="true">4.2.</strong> Data Definition Statements</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="sql/ddl/create_table.html"><strong aria-hidden="true">4.2.1.</strong> CREATE TABLE</a></li><li class="chapter-item expanded "><a href="sql/ddl/alter_table.html"><strong aria-hidden="true">4.2.2.</strong> ALTER TABLE</a></li></ol></li><li class="chapter-item expanded "><a href="sql/dml/index.html"><strong aria-hidden="true">4.3.</strong> Data Manipulation Statements</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="sql/dml/insert.html"><strong aria-hidden="true">4.3.1.</strong> INSERT</a></li><li class="chapter-item expanded "><a href="sql/dml/select.html"><strong aria-hidden="true">4.3.2.</strong> SELECT</a></li></ol></li><li class="chapter-item expanded "><a href="sql/utility.html"><strong aria-hidden="true">4.4.</strong> Utility Statements</a></li></ol></li><li class="chapter-item expanded "><a href="analytic_engine/index.html"><strong aria-hidden="true">5.</strong> Analytic Engine</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="analytic_engine/options.html"><strong aria-hidden="true">5.1.</strong> Options</a></li></ol></li><li class="chapter-item expanded "><a href="deploy/index.html"><strong aria-hidden="true">6.</strong> Deployment</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="deploy/static_routing.html"><strong aria-hidden="true">6.1.</strong> Static Routing</a></li></ol></li><li class="chapter-item expanded "><a href="sdk.html"><strong aria-hidden="true">7.</strong> Develop Kits</a></li><li class="chapter-item expanded "><a href="protocol.html"><strong aria-hidden="true">8.</strong> Protocol</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="trouble_shooting.html"><strong aria-hidden="true">9.</strong> Trouble Shooting</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CeresDB User Guide</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div style="break-before: page; page-break-before: always;"></div><h1 id="quick-start"><a class="header" href="#quick-start">Quick Start</a></h1>
<p>This page shows you how to get started with CeresDB quickly. You'll start a standalone CeresDB server, and then insert and read some sample data using SQL.</p>
<h2 id="start-server"><a class="header" href="#start-server">Start server</a></h2>
<p><a href="https://hub.docker.com/r/ceresdb/ceresdb-server">CeresDB docker image</a> is the easiest way to get started, if you haven't install Docker, go <a href="https://www.docker.com/products/docker-desktop/">there</a> to install it first.</p>
<p>You can use command below to start a standalone server</p>
<pre><code class="language-bash">docker run --name ceresdb-server \
  -p 8831:8831 \
  -p 3307:3307 \
  -p 5440:5440 \
  ceresdb/ceresdb-server:v0.2.0
</code></pre>
<p>CeresDB will listen three ports when start:</p>
<ul>
<li>8831, gRPC port</li>
<li>3307, MySQL port</li>
<li>5440, HTTP port</li>
</ul>
<p>The easiest to use is HTTP, so sections below will use it for demo. For production environments, gRPC/MySQL are recommended.</p>
<h2 id="write-and-read-data"><a class="header" href="#write-and-read-data">Write and read data</a></h2>
<h3 id="create-table"><a class="header" href="#create-table">Create table</a></h3>
<pre><code class="language-shell">curl --location --request POST 'http://127.0.0.1:5440/sql' \
--header 'Content-Type: application/json' \
--data-raw '{
    &quot;query&quot;: &quot;CREATE TABLE `demo` (`name` string TAG, `value` double NOT NULL, `t` timestamp NOT NULL, TIMESTAMP KEY(t)) ENGINE=Analytic with (enable_ttl='\''false'\'')&quot;
}'
</code></pre>
<h3 id="write-data"><a class="header" href="#write-data">Write data</a></h3>
<pre><code class="language-shell">curl --location --request POST 'http://127.0.0.1:5440/sql' \
--header 'Content-Type: application/json' \
--data-raw '{
    &quot;query&quot;: &quot;INSERT INTO demo(t, name, value) VALUES(1651737067000, '\''ceresdb'\'', 100)&quot;
}'
</code></pre>
<h3 id="read-data"><a class="header" href="#read-data">Read data</a></h3>
<pre><code class="language-shell">curl --location --request POST 'http://127.0.0.1:5440/sql' \
--header 'Content-Type: application/json' \
--data-raw '{
    &quot;query&quot;: &quot;select * from demo&quot;
}'
</code></pre>
<h3 id="show-create-table"><a class="header" href="#show-create-table">Show create table</a></h3>
<pre><code class="language-shell">curl --location --request POST 'http://127.0.0.1:5440/sql' \
--header 'Content-Type: application/json' \
--data-raw '{
    &quot;query&quot;: &quot;show create table demo&quot;
}'
</code></pre>
<h3 id="drop-table"><a class="header" href="#drop-table">Drop table</a></h3>
<pre><code class="language-shell">curl --location --request POST 'http://127.0.0.1:5440/sql' \
--header 'Content-Type: application/json' \
--data-raw '{
    &quot;query&quot;: &quot;DROP TABLE demo&quot;
}'
</code></pre>
<h2 id="using-the-sdks"><a class="header" href="#using-the-sdks">Using the SDKs</a></h2>
<p>See <a href="./sdk.html">sdk</a></p>
<h2 id="next-step"><a class="header" href="#next-step">Next Step</a></h2>
<p>Congrats, you have finished this tutorial. For more information about CeresDB, see the following:</p>
<ul>
<li><a href="./model">Data Model</a></li>
<li><a href="./analytic_engine">Analytic Engine</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data-model"><a class="header" href="#data-model">Data Model</a></h1>
<p>This chapter introduces the data model of CeresDB.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data-types"><a class="header" href="#data-types">Data Types</a></h1>
<p>CeresDB implements table model, and the supported data types are similar to MySQL.
The following table lists the mapping relationship between MySQL and CeresDB.</p>
<h2 id="support-data-typecase-insensitive"><a class="header" href="#support-data-typecase-insensitive">Support Data Type(case-insensitive)</a></h2>
<div class="table-wrapper"><table><thead><tr><th>SQL</th><th>CeresDB</th></tr></thead><tbody>
<tr><td>null</td><td>Null</td></tr>
<tr><td>timestamp</td><td>Timestamp</td></tr>
<tr><td>double</td><td>Double</td></tr>
<tr><td>float</td><td>Float</td></tr>
<tr><td>string</td><td>String</td></tr>
<tr><td>Varbinary</td><td>Varbinary</td></tr>
<tr><td>uint64</td><td>UInt64</td></tr>
<tr><td>uint32</td><td>UInt32</td></tr>
<tr><td>uint16</td><td>UInt16</td></tr>
<tr><td>uint8</td><td>UInt8</td></tr>
<tr><td>int64/bigint</td><td>Int64</td></tr>
<tr><td>int32/int</td><td>Int32</td></tr>
<tr><td>int16/smallint</td><td>Int16</td></tr>
<tr><td>int8/tinyint</td><td>Int8</td></tr>
<tr><td>boolean</td><td>Boolean</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="special-columns"><a class="header" href="#special-columns">Special Columns</a></h1>
<p>Tables in CeresDB have the following constraints:</p>
<ul>
<li>Primary key is required</li>
<li>The primary key must contain a time column, and can only contain one time column</li>
<li>The primary key must be non-null, so all columns in primary key must be non-null.</li>
</ul>
<h2 id="timestamp-column"><a class="header" href="#timestamp-column">Timestamp Column</a></h2>
<p>Tables in CeresDB must have one timestamp column maps to timestamp in timeseries data, such as timestamp in OpenTSDB/Prometheus.
The timestamp column can be set with <code>timestamp key</code> keyword, like <code>TIMESTAMP KEY(ts)</code>.</p>
<h2 id="tag-column"><a class="header" href="#tag-column">Tag column</a></h2>
<p><code>Tag</code> is use to defined column as tag column, similar to tag in timeseries data, such as tag in OpenTSDB and label in Prometheus.</p>
<h2 id="primary-key"><a class="header" href="#primary-key">Primary key</a></h2>
<p>The primary key is used for data deduplication and sorting. The primary key is composed of some columns and one time column.
The primary key can be set in the following some waysï¼š</p>
<ul>
<li>use <code>primary key</code> keyword</li>
<li>use <code>tag</code> to auto generate TSID, CeresDB will use <code>(timestamp,TSID)</code> as primary key</li>
<li>only set Timestamp column, CeresDB will use <code>(timestamp)</code> as primary key</li>
</ul>
<p>Notice: If the primary key and tag are specified at the same time, then the tag column is just an additional information identification and will not affect the logic.</p>
<pre><code class="language-sql">CREATE TABLE with_primary_key(
  ts TIMESTAMP NOT NULL,
  c1 STRING NOT NULL,
  c2 STRING NULL,
  c4 STRING NULL,
  c5 STRING NULL,
  TIMESTAMP KEY(ts),
  PRIMARY KEY(c1, ts)
) ENGINE=Analytic WITH (ttl='7d');
  
CREATE TABLE with_tag(
    ts TIMESTAMP NOT NULL,
    c1 STRING TAG NOT NULL,
    c2 STRING TAG NULL,
    c3 STRING TAG NULL,
    c4 DOUBLE NULL,
    c5 STRING NULL,
    c6 STRING NULL,
    TIMESTAMP KEY(ts)
) ENGINE=Analytic WITH (ttl='7d');

CREATE TABLE with_timestamp(
    ts TIMESTAMP NOT NULL,
    c1 STRING NOT NULL,
    c2 STRING NULL,
    c3 STRING NULL,
    c4 DOUBLE NULL,
    c5 STRING NULL,
    c6 STRING NULL,
    TIMESTAMP KEY(ts)
) ENGINE=Analytic WITH (ttl='7d');
</code></pre>
<h2 id="tsid"><a class="header" href="#tsid">TSID</a></h2>
<p>If <code>primary key</code>is not set, and tag columns is provided, TSID will auto generated from hash of tag columns. 
In essence, this is also a mechanism for automatically generating id.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql-syntax"><a class="header" href="#sql-syntax">SQL Syntax</a></h1>
<p>This chapter introduces the SQL interface of CeresDB.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="identifier"><a class="header" href="#identifier">Identifier</a></h1>
<p>Identifier in CeresDB can be used as table name, column name etc. It cannot be preserved keywords or start with number and punctuation symbols. CeresDB allows to quote identifiers with back quotes (`). In this case it can be any string like <code>00_table</code> or <code>select</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data-definition-statements"><a class="header" href="#data-definition-statements">Data Definition Statements</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create-table-1"><a class="header" href="#create-table-1">CREATE TABLE</a></h1>
<h2 id="basic-syntax"><a class="header" href="#basic-syntax">Basic syntax</a></h2>
<p>Basic syntax (parts between <code>[]</code> are optional):</p>
<pre><code class="language-sql">CREATE TABLE [IF NOT EXIST] 
    table_name ( column_definitions ) 
    ENGINE = engine_type 
    [WITH ( table_options )];
</code></pre>
<p>Column definition syntax:</p>
<pre><code class="language-sql">column_name column_type [[NOT] NULL] {[TAG] | [TIMESTAMP KEY] | [PRIMARY KEY]}
</code></pre>
<p>Table options syntax are key-value pairs. Value should be quote with quotation marks (<code>'</code>). E.g.:</p>
<pre><code class="language-sql">... WITH ( enable_ttl='false' )
</code></pre>
<h2 id="if-not-exist"><a class="header" href="#if-not-exist">IF NOT EXIST</a></h2>
<p>Add <code>IF NOT EXIST</code> to tell CeresDB to ignore errors if the table name already exists.</p>
<h2 id="define-column"><a class="header" href="#define-column">Define Column</a></h2>
<p>A column's definition should at least contains the name and type parts. All supported types are listed <a href="sql/ddl/../../model/data_types.html">here</a>.</p>
<p>Column is default be nullable. i.e. <code>NULL</code> keyword is implied. Adding <code>NOT NULL</code> constrains to make it required.</p>
<pre><code class="language-sql">-- this definition
a_nullable int
-- equals to
a_nullable int NULL

-- add NOT NULL to make it required
b_not_null NOT NULL
</code></pre>
<p>A column can be marked as <a href="sql/ddl/../../model/special_columns.html">special column</a> with related keyword.</p>
<h2 id="engine"><a class="header" href="#engine">Engine</a></h2>
<p>Specifies which engine this table belongs to. CeresDB current support <a href="sql/ddl/../../analytic_engine/README.html"><code>Analytic</code></a> engine type. This attribute is immutable.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="alter-table"><a class="header" href="#alter-table">ALTER TABLE</a></h1>
<p><code>ALTER TABLE</code> can change the schema or options of a table.</p>
<p>CeresDB current supports <code>ADD COLUMN</code>.</p>
<pre><code class="language-sql">-- create a table and add a column to it
CREATE TABLE `t`(a int, t timestamp NOT NULL, TIMESTAMP KEY(t)) ENGINE = Analytic;
ALTER TABLE `t` ADD COLUMN (b string);
</code></pre>
<p>It now becomes</p>
<pre><code>-- DESCRIBE TABLE `t`;

name    type        is_primary  is_nullable is_tag

t       timestamp   true        false       false
tsid    uint64      true        false       false
a       int         false       true        false
b       string      false       true        false
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="data-manipulation-statements"><a class="header" href="#data-manipulation-statements">Data Manipulation Statements</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="insert"><a class="header" href="#insert">INSERT</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="select"><a class="header" href="#select">SELECT</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="utility-statements"><a class="header" href="#utility-statements">Utility Statements</a></h1>
<p>There are serval utilities SQL in CeresDB that can help in table manipulation or query inspection.</p>
<h2 id="show-create-table-1"><a class="header" href="#show-create-table-1">SHOW CREATE TABLE</a></h2>
<pre><code class="language-sql">SHOW CREATE TABLE table_name;
</code></pre>
<p><code>SHOW CREATE TABLE</code> returns a <code>CREATE TABLE</code> DDL that will create a same table with the given one. Including columns, table engine and options. The schema and options shows in <code>CREATE TABLE</code> will based on the current version of the table. An example:</p>
<pre><code class="language-sql">-- create one table
CREATE TABLE `t` (a bigint, b int default 3, c string default 'x', d smallint null, t timestamp NOT NULL, TIMESTAMP KEY(t)) ENGINE = Analytic;
-- Result: affected_rows: 0

-- show how one table should be created.
SHOW CREATE TABLE `t`;

-- Result DDL:
CREATE TABLE `t` (
    `t` timestamp NOT NULL,
    `tsid` uint64 NOT NULL,
    `a` bigint,
    `b` int,
    `c` string,
    `d` smallint,
    PRIMARY KEY(t,tsid),
    TIMESTAMP KEY(t)
) ENGINE=Analytic WITH (
    arena_block_size='2097152',
    compaction_strategy='default',
    compression='ZSTD',
    enable_ttl='true',
    num_rows_per_row_group='8192',
    segment_duration='',
    ttl='7d',
    update_mode='OVERWRITE',
    write_buffer_size='33554432'
)
</code></pre>
<h2 id="describe"><a class="header" href="#describe">DESCRIBE</a></h2>
<pre><code class="language-sql">DESCRIBE table_name;
</code></pre>
<p><code>DESCRIBE</code> will show a detailed schema of one table. The attributes include column name and type, whether it is tag and primary key (todo: ref) and whether it's nullable. The auto created column <code>tsid</code> will also be included (todo: ref).</p>
<p>Example:</p>
<pre><code class="language-sql">CREATE TABLE `t`(a int, b string, t timestamp NOT NULL, TIMESTAMP KEY(t)) ENGINE = Analytic;

DESCRIBE TABLE `t`;
</code></pre>
<p>The result is:</p>
<pre><code>name    type        is_primary  is_nullable is_tag

t       timestamp   true        false       false
tsid    uint64      true        false       false
a       int         false       true        false
b       string      false       true        false
</code></pre>
<h2 id="explain"><a class="header" href="#explain">EXPLAIN</a></h2>
<pre><code class="language-sql">EXPLAIN query;
</code></pre>
<p><code>EXPLAIN</code> shows how a query will be executed. Add it to the beginning of a query like</p>
<pre><code class="language-sql">EXPLAIN SELECT max(value) AS c1, avg(value) AS c2 FROM `t` GROUP BY name;
</code></pre>
<p>will give</p>
<pre><code>logical_plan
Projection: #MAX(07_optimizer_t.value) AS c1, #AVG(07_optimizer_t.value) AS c2
  Aggregate: groupBy=[[#07_optimizer_t.name]], aggr=[[MAX(#07_optimizer_t.value), AVG(#07_optimizer_t.value)]]
    TableScan: 07_optimizer_t projection=Some([name, value])

physical_plan
ProjectionExec: expr=[MAX(07_optimizer_t.value)@1 as c1, AVG(07_optimizer_t.value)@2 as c2]
  AggregateExec: mode=FinalPartitioned, gby=[name@0 as name], aggr=[MAX(07_optimizer_t.value), AVG(07_optimizer_t.value)]
    CoalesceBatchesExec: target_batch_size=4096
      RepartitionExec: partitioning=Hash([Column { name: \&quot;name\&quot;, index: 0 }], 6)
        AggregateExec: mode=Partial, gby=[name@0 as name], aggr=[MAX(07_optimizer_t.value), AVG(07_optimizer_t.value)]
          ScanTable: table=07_optimizer_t, parallelism=8, order=None
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="analytic-engine"><a class="header" href="#analytic-engine">Analytic Engine</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="options"><a class="header" href="#options">Options</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deployment"><a class="header" href="#deployment">Deployment</a></h1>
<p>CeresDB is a distributed timeseries database, that is to say, multiple CeresDB instances can be deployed as a cluster to serve with high availability and scalability.</p>
<p>For now, CeresDB only supports one deployment form that features static, rule-based routing. In the future (maybe in 1.0.0 version), a powerful cluster deployment will be supported and then CeresDB cluster will support more great features, including dynamic expansion, data reliability and etc.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="static-routing"><a class="header" href="#static-routing">Static Routing</a></h1>
<p>This guide shows how to deloy a CeresDB cluster with static, rule-based routing.</p>
<p>The crucial point here is that CeresDB server provides configurable routing function on table name so what we need is just a valid config containing routing rules which will be shipped to every CeresDB instance in the cluster.</p>
<h2 id="target"><a class="header" href="#target">Target</a></h2>
<p>First of all, let's assume that our target is to deploy a cluster consisting of two CeresDB instances on the same machine. And a large cluster of more CeresDB instances can deployed according to the two-instances example.</p>
<h2 id="prepare-config"><a class="header" href="#prepare-config">Prepare Config</a></h2>
<h3 id="basic"><a class="header" href="#basic">Basic</a></h3>
<p>Suppose the basic config of CeresDB is:</p>
<pre><code class="language-toml">bind_addr = &quot;0.0.0.0&quot;
http_port = 5440
grpc_port = 8831
log_level = &quot;info&quot;
enable_cluster = true

[analytic]
wal_path = &quot;/tmp/ceresdb&quot;

[analytic.storage]
type = &quot;Local&quot;
data_path = &quot;/tmp/ceresdb&quot;
</code></pre>
<p>In order to deploy two CeresDB instances on the same machine, the config should choose different ports to serve and data directories to store data.</p>
<p>Say the <code>CeresDB_0</code>'s config is:</p>
<pre><code class="language-toml">bind_addr = &quot;0.0.0.0&quot;
http_port = 5440
grpc_port = 8831
log_level = &quot;info&quot;
enable_cluster = true

[analytic]
wal_path = &quot;/tmp/ceresdb_0&quot;

[analytic.storage]
type = &quot;Local&quot;
data_path = &quot;/tmp/ceresdb_0&quot;
</code></pre>
<p>Then the <code>CeresDB_1</code>'s config is:</p>
<pre><code class="language-toml">bind_addr = &quot;0.0.0.0&quot;
http_port = 15440
grpc_port = 18831
log_level = &quot;info&quot;
enable_cluster = true

[analytic]
wal_path = &quot;/tmp/ceresdb_1&quot;

[analytic.storage]
type = &quot;Local&quot;
data_path = &quot;/tmp/ceresdb_1&quot;
</code></pre>
<h3 id="schemashard-declaration"><a class="header" href="#schemashard-declaration">Schema&amp;Shard declaration</a></h3>
<p>Then we should define the common part -- schema&amp;shard declaration and routing rules.</p>
<p>Here is the config for schema&amp;shard declaration:</p>
<pre><code class="language-toml">[[meta_client.cluster_view.schema_shards]]
schema = 'public_0'
[[meta_client.cluster_view.schema_shards.shard_views]]
shard_id = 0
[meta_client.cluster_view.schema_shards.shard_views.node]
addr = '127.0.0.1'
port = 8831
[[meta_client.cluster_view.schema_shards.shard_views]]
shard_id = 1
[meta_client.cluster_view.schema_shards.shard_views.node]
addr = '127.0.0.1'
port = 8831

[[meta_client.cluster_view.schema_shards]]
schema = 'public_1'
[[meta_client.cluster_view.schema_shards.shard_views]]
shard_id = 0
[meta_client.cluster_view.schema_shards.shard_views.node]
addr = '127.0.0.1'
port = 8831
[[meta_client.cluster_view.schema_shards.shard_views]]
shard_id = 1
[meta_client.cluster_view.schema_shards.shard_views.node]
addr = '127.0.0.1'
port = 18831
</code></pre>
<p>In the config above, two schemas are declared:</p>
<ul>
<li><code>public_0</code> has two shards served by <code>CeresDB_0</code>.</li>
<li><code>public_1</code> has two shards served by both <code>CeresDB_0</code> and <code>CeresDB_1</code>.</li>
</ul>
<h3 id="routing-rules"><a class="header" href="#routing-rules">Routing rules</a></h3>
<p>Provided with shcema&amp;shard declaration, routing rules can be defined and here is an example of prefix rule:</p>
<pre><code class="language-toml">[[route_rules.prefix_rules]]
schema = 'public_0'
prefix = 'prod_'
shard = 0
</code></pre>
<p>This rule means that all the table with <code>prod_</code> prefix belonging to <code>public_0</code> should be routed to <code>shard_0</code> of <code>public_0</code>, that is to say, <code>CeresDB_0</code>. As for the other tables whose names are not prefixed by <code>prod_</code> will be routed by hash to both <code>shard_0</code> and <code>shard_1</code> of <code>public_0</code>.</p>
<p>Besides prefix rule, we can also define a hash rule:</p>
<pre><code class="language-toml">[[route_rules.hash_rules]]
schema = 'public_1'
shards = [0, 1]
</code></pre>
<p>This rule tells CeresDB to route <code>public_1</code>'s tables to both <code>shard_0</code> and <code>shard_1</code> of <code>public_1</code>, that is to say, <code>CeresDB0</code> and <code>CeresDB_1</code>. And actually this is default routing behavior if no such rule provided for schema <code>public_1</code>.</p>
<p>For now, we can provide the full example config for <code>CeresDB_0</code> and <code>CeresDB_1</code>:</p>
<pre><code class="language-toml">bind_addr = &quot;0.0.0.0&quot;
http_port = 5440
grpc_port = 8831
log_level = &quot;info&quot;
enable_cluster = true

[analytic]
wal_path = &quot;/tmp/ceresdb_0&quot;

[analytic.storage]
type = &quot;Local&quot;
data_path = &quot;/tmp/ceresdb_0&quot;

[[meta_client.cluster_view.schema_shards]]
schema = 'public_0'
[[meta_client.cluster_view.schema_shards.shard_views]]
shard_id = 0
[meta_client.cluster_view.schema_shards.shard_views.node]
addr = '127.0.0.1'
port = 8831
[[meta_client.cluster_view.schema_shards.shard_views]]
shard_id = 1
[meta_client.cluster_view.schema_shards.shard_views.node]
addr = '127.0.0.1'
port = 8831

[[meta_client.cluster_view.schema_shards]]
schema = 'public_1'
[[meta_client.cluster_view.schema_shards.shard_views]]
shard_id = 0
[meta_client.cluster_view.schema_shards.shard_views.node]
addr = '127.0.0.1'
port = 8831
[[meta_client.cluster_view.schema_shards.shard_views]]
shard_id = 1
[meta_client.cluster_view.schema_shards.shard_views.node]
addr = '127.0.0.1'
port = 18831

[[route_rules.prefix_rules]]
schema = 'public_0'
prefix = 'prod_'
shard = 0

[[route_rules.hash_rules]]
schema = 'public_1'
shards = [0, 1]
</code></pre>
<pre><code class="language-toml">bind_addr = &quot;0.0.0.0&quot;
http_port = 15440
grpc_port = 18831
log_level = &quot;info&quot;
enable_cluster = true

[analytic]
wal_path = &quot;/tmp/ceresdb_1&quot;

[analytic.storage]
type = &quot;Local&quot;
data_path = &quot;/tmp/ceresdb_1&quot;

[[meta_client.cluster_view.schema_shards]]
schema = 'public_0'
[[meta_client.cluster_view.schema_shards.shard_views]]
shard_id = 0
[meta_client.cluster_view.schema_shards.shard_views.node]
addr = '127.0.0.1'
port = 8831
[[meta_client.cluster_view.schema_shards.shard_views]]
shard_id = 1
[meta_client.cluster_view.schema_shards.shard_views.node]
addr = '127.0.0.1'
port = 8831

[[meta_client.cluster_view.schema_shards]]
schema = 'public_1'
[[meta_client.cluster_view.schema_shards.shard_views]]
shard_id = 0
[meta_client.cluster_view.schema_shards.shard_views.node]
addr = '127.0.0.1'
port = 8831
[[meta_client.cluster_view.schema_shards.shard_views]]
shard_id = 1
[meta_client.cluster_view.schema_shards.shard_views.node]
addr = '127.0.0.1'
port = 18831

[[route_rules.prefix_rules]]
schema = 'public_0'
prefix = 'prod_'
shard = 0

[[route_rules.hash_rules]]
schema = 'public_1'
shards = [0, 1]
</code></pre>
<p>Let's call the two different config files as <code>config_0.toml</code> and <code>config_1.toml</code> but you should know in the real environment the different CeresDB intances can be deployed across different machines, that is to say, there is no need to choose different ports and data directories for different CeresDB instances so that all the CeresDB instances can share one exactly <strong>same</strong> config file.</p>
<h2 id="start-ceresdbs"><a class="header" href="#start-ceresdbs">Start CeresDBs</a></h2>
<p>After the configs are prepared, what we should to do is to start CeresDB container with the specific config.</p>
<p>Just run the commands below:</p>
<pre><code class="language-shell">sudo docker run -d -t --name ceresdb_0 -p 5440:5440 -p 8831:8831 -v $(pwd)/config_0.toml:/etc/ceresdb/ceresdb.toml ceresdb/ceresdb-server:v0.1.0-alpha
sudo docker run -d -t --name ceresdb_1 -p 15440:15440 -p 18831:18831 -v $(pwd)/config_1.toml:/etc/ceresdb/ceresdb.toml ceresdb/ceresdb-server:v0.1.0-alpha
</code></pre>
<p>After the two containers are created and starting running, read and write requests can be served by the two-instances CeresDB cluster. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="develop-kits"><a class="header" href="#develop-kits">Develop Kits</a></h1>
<ul>
<li><a href="https://github.com/CeresDB/ceresdb-client-rs">Rust</a></li>
<li><a href="https://github.com/CeresDB/ceresdb-client-java">Java</a></li>
<li><a href="https://github.com/CeresDB/ceresdb-client-py">Python</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="protocol"><a class="header" href="#protocol">Protocol</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="trouble-shooting"><a class="header" href="#trouble-shooting">Trouble Shooting</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
